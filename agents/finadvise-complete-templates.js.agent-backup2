const dotenv = require('dotenv');
dotenv.config();

/**
 * FinAdvise Complete WhatsApp Template Collection
 * Professional templates with images and actual financial content
 */

const axios = require('axios');
const fs = require('fs').promises;
const path = require('path');

class FinAdviseCompleteTemplates {
    constructor() {
        this.config = {
            phoneNumberId: process.env.WHATSAPP_PHONE_NUMBER_ID,
            businessAccountId: process.env.WHATSAPP_BUSINESS_ACCOUNT_ID,
            bearerToken: 'EAATOFQtMe9gBPXrmwK1MDrvlBAWfbeevjzXs8PgT15GPsKADHmzJPWZBvnyhAYTjSfoAzOZC97CHQ27X6jE1iOjNZCehO2WrxPiEfRnhLO3sZA0iJ93Sh7ZB49ZBnF12CWCVTpB1WMfpRgpCdv5hXWIbWgzaHFovUPaZBQBDSa7p74ZCIKvZCtyLo3rj8dzDZAs74GaQZDZD',
            apiVersion: 'v18.0'
        };
        
        // Complete set of professional templates with rich content
        this.completeTemplates = {
            
            // ========== FAMILY SEGMENT TEMPLATES ==========
            
            family_monthly_wealth_report: {
                name: 'family_monthly_wealth_report',
                language: 'en',
                category: 'MARKETING',
                components: [
                    {
                        type: 'HEADER',
                        format: 'IMAGE',
                        example: {
                            header_handle: ['https://example.com/family-wealth-growth-chart.jpg']
                        }
                    },
                    {
                        type: 'BODY',
                        text: `Dear {{1}},

üìä *Your Family Wealth Report - {{2}}*

*Portfolio Performance:*
‚Ä¢ Total Value: ‚Çπ{{3}}
‚Ä¢ Monthly Growth: {{4}}%
‚Ä¢ YTD Returns: {{5}}%

*Goal Progress:*
üè† Home Purchase Fund: {{6}}% complete
üéì Children Education: ‚Çπ{{7}} accumulated
üíä Health Emergency Fund: ‚úÖ Fully funded
üë¥ Retirement Corpus: On track

*This Month's Achievements:*
‚ú® SIP investments grew by ‚Çπ{{8}}
‚ú® Tax saved through ELSS: ‚Çπ{{9}}

*Action Items:*
1. Review term insurance (currently ‚Çπ{{10}} crores)
2. Increase SIP by 10% (recommended)
3. Start PPF for tax benefits

Schedule your monthly review: [Call Now]`,
                        example: {
                            body_text: [
                                ['Shruti', 'March 2024', '45,00,000', '2.3', '18.5', '73', '12,00,000', '48,000', '15,000', '1']
                            ]
                        }
                    },
                    {
                        type: 'FOOTER',
                        text: 'FinAdvise - Building Generational Wealth'
                    },
                    {
                        type: 'BUTTONS',
                        buttons: [
                            { type: 'PHONE_NUMBER', text: 'Call Advisor', phone_number: '+919999999999' },
                            { type: 'URL', text: 'View Dashboard', url: 'https://finadvise.com/dashboard' }
                        ]
                    }
                ]
            },
            
            family_insurance_review: {
                name: 'family_insurance_review',
                language: 'en',
                category: 'UTILITY',
                components: [
                    {
                        type: 'HEADER',
                        format: 'IMAGE',
                        example: {
                            header_handle: ['https://example.com/insurance-shield.jpg']
                        }
                    },
                    {
                        type: 'BODY',
                        text: `Hi {{1}} üè•

*Insurance Coverage Analysis*

Your family needs ‚Çπ{{2}} crores coverage
Current coverage: ‚Çπ{{3}} crores
*Gap: ‚Çπ{{4}} crores* ‚ö†Ô∏è

*Recommended Actions:*
‚úÖ Add ‚Çπ50 lakh term plan (‚Çπ{{5}}/month)
‚úÖ Enhance health cover to ‚Çπ25 lakhs
‚úÖ Add critical illness rider

*Why this matters:*
‚Ä¢ Medical inflation: 14% annually
‚Ä¢ Education costs rising 10% yearly
‚Ä¢ Protect family lifestyle

Get quotes now? Reply YES`,
                        example: {
                            body_text: [
                                ['Shruti', '3', '1', '2', '1,800']
                            ]
                        }
                    }
                ]
            },
            
            family_sip_performance: {
                name: 'family_sip_performance',
                language: 'en', 
                category: 'MARKETING',
                components: [
                    {
                        type: 'HEADER',
                        format: 'TEXT',
                        text: 'üìà SIP Performance Update'
                    },
                    {
                        type: 'BODY',
                        text: `{{1}}, your SIPs are creating wealth! 

*Current SIPs:*
‚Ä¢ Equity Fund: ‚Çπ{{2}}/month ‚Üí ‚Çπ{{3}} value
‚Ä¢ Balanced Fund: ‚Çπ{{4}}/month ‚Üí ‚Çπ{{5}} value
‚Ä¢ ELSS (Tax Saver): ‚Çπ{{6}}/month ‚Üí ‚Çπ{{7}} value

*Total Investment:* ‚Çπ{{8}}
*Current Value:* ‚Çπ{{9}}
*Profit:* ‚Çπ{{10}} ({{11}}% returns)

üéØ *Projection:* ‚Çπ{{12}} lakhs in 10 years

Increase SIP by ‚Çπ2,000? It adds ‚Çπ15 lakhs!`,
                        example: {
                            body_text: [
                                ['Shruti', '10,000', '6,50,000', '5,000', '3,20,000', '5,000', '2,80,000', 
                                 '8,00,000', '12,50,000', '4,50,000', '56.25', '85']
                            ]
                        }
                    }
                ]
            },
            
            // ========== ENTREPRENEUR SEGMENT TEMPLATES ==========
            
            entrepreneur_business_wealth: {
                name: 'entrepreneur_business_wealth',
                language: 'en',
                category: 'MARKETING',
                components: [
                    {
                        type: 'HEADER',
                        format: 'IMAGE',
                        example: {
                            header_handle: ['https://example.com/business-growth-chart.jpg']
                        }
                    },
                    {
                        type: 'BODY',
                        text: `{{1}}, optimize your business wealth! üíº

*Business vs Personal Portfolio:*

*Business Assets:* ‚Çπ{{2}} Cr
*Personal Investments:* ‚Çπ{{3}} lakhs
*Ratio:* {{4}}:{{5}} (Target 70:30)

*Diversification Strategy:*
üìä Equity MFs: ‚Çπ{{6}}L ({{7}}% returns)
üè¢ REITs: ‚Çπ{{8}}L ({{9}}% yield)
üí∞ Liquid Funds: ‚Çπ{{10}}L (emergency)
üåç International: ‚Çπ{{11}}L

*Tax Optimization:*
‚Ä¢ Saved via ELSS: ‚Çπ{{12}}
‚Ä¢ HUF benefits: ‚Çπ{{13}}
‚Ä¢ Corporate structure: ‚Çπ{{14}} saved

*Q4 Opportunity:* Pre-IPO placement in fintech
Expected returns: 35-40% in 18 months
Allocation suggested: ‚Çπ25 lakhs

Interested?`,
                        example: {
                            body_text: [
                                ['Avalok', '5', '75', '87', '13', '35', '22', '15', '8.5', '15', '10',
                                 '46,800', '25,000', '1,20,000']
                            ]
                        }
                    },
                    {
                        type: 'BUTTONS',
                        buttons: [
                            { type: 'QUICK_REPLY', text: 'Yes, Tell More' },
                            { type: 'QUICK_REPLY', text: 'Schedule Call' }
                        ]
                    }
                ]
            },
            
            entrepreneur_market_opportunity: {
                name: 'entrepreneur_market_opportunity',
                language: 'en',
                category: 'UTILITY',
                components: [
                    {
                        type: 'HEADER',
                        format: 'TEXT',
                        text: 'üî• Hot Investment Alert'
                    },
                    {
                        type: 'BODY',
                        text: `{{1}}, exclusive opportunity:

*{{2}}*

Sector: {{3}}
Entry: ‚Çπ{{4}}
Target: ‚Çπ{{5}} ({{6}} months)
Upside: {{7}}%

*Why Now:*
{{8}}

*Risk-Reward:* {{9}}/10
*Allocation:* Max {{10}}% of portfolio

Our research indicates strong momentum.

Quick action needed - closing in 48 hours.

Reserve allocation?`,
                        example: {
                            body_text: [
                                ['Avalok', 'Tech Sector NFO - AI Focus Fund', 'Technology', '100', '145', '18', '45',
                                 'AI adoption accelerating, government support increasing', '7', '5']
                            ]
                        }
                    }
                ]
            },
            
            entrepreneur_tax_planning: {
                name: 'entrepreneur_tax_planning',
                language: 'en',
                category: 'UTILITY',
                components: [
                    {
                        type: 'HEADER',
                        format: 'DOCUMENT',
                        example: {
                            header_handle: ['https://example.com/tax-saving-guide.pdf']
                        }
                    },
                    {
                        type: 'BODY',
                        text: `{{1}}, save ‚Çπ{{2}} in taxes! üí∞

*Your Tax Optimization Plan:*

Current tax liability: ‚Çπ{{3}}
After optimization: ‚Çπ{{4}}
*Savings: ‚Çπ{{5}}*

*Strategies to implement:*
1. ELSS Investment: ‚Çπ1.5L (save ‚Çπ46,800)
2. NPS Contribution: ‚Çπ50K (save ‚Çπ15,600)  
3. Health Insurance: ‚Çπ50K (save ‚Çπ15,600)
4. HUF Structure: Save ‚Çπ{{6}} annually
5. Corporate restructuring: ‚Çπ{{7}} benefit

*Deadline: {{8}} days* ‚è∞

Attached: Complete tax plan

Shall we execute?`,
                        example: {
                            body_text: [
                                ['Avalok', '3,85,000', '12,50,000', '8,65,000', '3,85,000',
                                 '1,25,000', '2,00,000', '15']
                            ]
                        }
                    }
                ]
            },
            
            // ========== RETIREE SEGMENT TEMPLATES ==========
            
            retirement_income_statement: {
                name: 'retirement_income_statement',
                language: 'en',
                category: 'UTILITY',
                components: [
                    {
                        type: 'HEADER',
                        format: 'IMAGE',
                        example: {
                            header_handle: ['https://example.com/retirement-peace.jpg']
                        }
                    },
                    {
                        type: 'BODY',
                        text: `Good morning {{1}} üåÖ

*Your Monthly Income Summary:*

*Regular Income:*
‚Ä¢ Pension: ‚Çπ{{2}}
‚Ä¢ Senior Citizen Scheme: ‚Çπ{{3}}
‚Ä¢ Post Office MIS: ‚Çπ{{4}}
‚Ä¢ Debt Fund SWP: ‚Çπ{{5}}
‚Ä¢ Rental Income: ‚Çπ{{6}}

*Total Monthly: ‚Çπ{{7}}* ‚úÖ
*Expenses: ‚Çπ{{8}}*
*Surplus: ‚Çπ{{9}}*

*Corpus Status:*
‚Ä¢ Total Savings: ‚Çπ{{10}}
‚Ä¢ Emergency Fund: ‚Çπ{{11}} (6 months)
‚Ä¢ Health Reserve: ‚Çπ{{12}}

Your money is safe and growing steadily.

üòä Enjoy your retirement worry-free!`,
                        example: {
                            body_text: [
                                ['Vidyadhar', '35,000', '8,000', '5,500', '15,000', '12,000',
                                 '75,500', '55,000', '20,500', '85,00,000', '3,30,000', '10,00,000']
                            ]
                        }
                    },
                    {
                        type: 'FOOTER',
                        text: 'Your Trusted Retirement Partner'
                    }
                ]
            },
            
            retirement_health_wealth: {
                name: 'retirement_health_wealth',
                language: 'en',
                category: 'MARKETING',
                components: [
                    {
                        type: 'HEADER',
                        format: 'TEXT',
                        text: 'üè• Health & Wealth Update'
                    },
                    {
                        type: 'BODY',
                        text: `Dear {{1}},

*Health Coverage Status:*
‚úÖ Base Health Insurance: ‚Çπ{{2}} lakhs
‚úÖ Top-up Plan: ‚Çπ{{3}} lakhs  
‚úÖ Critical Illness: ‚Çπ{{4}} lakhs
‚úÖ Total Coverage: ‚Çπ{{5}} lakhs

*Medical Fund Performance:*
‚Ä¢ Reserved for health: ‚Çπ{{6}}
‚Ä¢ Growing at: {{7}}% annually
‚Ä¢ Covers {{8}} years of premiums

*New Benefits for Senior Citizens:*
‚Ä¢ Extra ‚Çπ50,000 tax deduction (Section 80D)
‚Ä¢ Increased exemption limit to ‚Çπ5 lakhs
‚Ä¢ No TDS on interest up to ‚Çπ50,000

Your health security is our priority.

Need any assistance?`,
                        example: {
                            body_text: [
                                ['Vidyadhar', '10', '25', '10', '45', '10,00,000', '8.2', '15']
                            ]
                        }
                    }
                ]
            },
            
            retirement_legacy_planning: {
                name: 'retirement_legacy_planning',
                language: 'en',
                category: 'UTILITY',
                components: [
                    {
                        type: 'HEADER',
                        format: 'TEXT',
                        text: 'üéÅ Legacy & Estate Planning'
                    },
                    {
                        type: 'BODY',
                        text: `{{1}}, secure your family's future:

*Your Estate Value: ‚Çπ{{2}} Cr*

*Current Allocation:*
‚Ä¢ Spouse: {{3}}%
‚Ä¢ Children: {{4}}%
‚Ä¢ Charity: {{5}}%

*Optimization Suggestions:*
‚úÖ Create Family Trust (save ‚Çπ{{6}} in taxes)
‚úÖ Gift deed for tax efficiency
‚úÖ Update Will and nominations
‚úÖ Consider REITS for regular income

*Immediate Benefits:*
‚Ä¢ Reduce estate tax by {{7}}%
‚Ä¢ Ensure smooth transfer
‚Ä¢ Avoid legal disputes

Would you like a detailed estate plan?`,
                        example: {
                            body_text: [
                                ['Vidyadhar', '2.5', '50', '45', '5', '45,00,000', '30']
                            ]
                        }
                    }
                ]
            },
            
            // ========== COMMON TEMPLATES ==========
            
            market_morning_brief: {
                name: 'market_morning_brief',
                language: 'en',
                category: 'UTILITY',
                components: [
                    {
                        type: 'HEADER',
                        format: 'TEXT',
                        text: '‚òÄÔ∏è Good Morning Market Update'
                    },
                    {
                        type: 'BODY',
                        text: `Good morning {{1}}! ‚òï

*Markets Today:*
üîπ Sensex: {{2}} ({{3}})
üîπ Nifty: {{4}} ({{5}})
üîπ Gold: ‚Çπ{{6}}/10g ({{7}})
üîπ USD/INR: {{8}}

*Your Portfolio:*
Current Value: ‚Çπ{{9}}
Today's Change: {{10}}
MTD Return: {{11}}%

*Trending:* {{12}}

Have a profitable day!`,
                        example: {
                            body_text: [
                                ['Shruti', '72,500', '+1.2%', '21,800', '+1.1%', '62,500', '+0.3%', '83.25',
                                 '45,00,000', '+‚Çπ48,000', '3.2', 'Banking stocks leading gains']
                            ]
                        }
                    }
                ]
            },
            
            appointment_reminder: {
                name: 'appointment_reminder',
                language: 'en',
                category: 'UTILITY',
                components: [
                    {
                        type: 'BODY',
                        text: `Hi {{1}}, reminder: Portfolio review scheduled for {{2}} at {{3}}. Agenda: {{4}}. Confirm? Reply YES/NO`,
                        example: {
                            body_text: [
                                ['Shruti', 'Tomorrow (March 15)', '4:00 PM', 'Quarterly review & insurance planning']
                            ]
                        }
                    }
                ]
            }
        };
    }
    
    /**
     * Register all complete templates
     */
    async registerAllCompleteTemplates() {
        console.log('================================================');
        console.log('REGISTERING COMPLETE FINADVISE TEMPLATES');
        console.log('================================================\n');
        console.log('Total Templates: ' + Object.keys(this.completeTemplates).length);
        console.log('Categories: Family (3), Entrepreneur (3), Retiree (3), Common (2)\n');
        
        const results = {
            submitted: [],
            failed: [],
            errors: {}
        };
        
        for (const [key, template] of Object.entries(this.completeTemplates)) {
            console.log(`üìù Submitting: ${template.name}`);
            
            try {
                const response = await axios.post(
                    `https://graph.facebook.com/${this.config.apiVersion}/${this.config.businessAccountId}/message_templates`,
                    template,
                    {
                        headers: {
                            'Authorization': `Bearer ${this.config.bearerToken}`,
                            'Content-Type': 'application/json'
                        }
                    }
                );
                
                results.submitted.push(template.name);
                console.log(`   ‚úÖ Submitted successfully (ID: ${response.data.id})`);
                
            } catch (error) {
                results.failed.push(template.name);
                results.errors[template.name] = error.response?.data?.error?.message || error.message;
                console.log(`   ‚ùå Failed: ${results.errors[template.name]}`);
            }
            
            // Rate limiting
            await new Promise(r => setTimeout(r, 1000));
        }
        
        console.log('\n================================================');
        console.log('SUBMISSION COMPLETE');
        console.log('================================================');
        console.log(`‚úÖ Submitted: ${results.submitted.length} templates`);
        console.log(`‚ùå Failed: ${results.failed.length} templates`);
        
        if (results.submitted.length > 0) {
            console.log('\nüìã Successfully Submitted:');
            results.submitted.forEach(t => console.log(`   ‚Ä¢ ${t}`));
        }
        
        console.log('\n‚è∞ NEXT STEPS:');
        console.log('1. Templates will be reviewed by Meta (1-24 hours)');
        console.log('2. Check approval status at:');
        console.log('   https://business.facebook.com ‚Üí WhatsApp Manager ‚Üí Message Templates');
        console.log('3. Once approved, full rich content will be sent automatically');
        
        return results;
    }
    
    /**
     * Generate actual message content for advisors
     */
    async generateActualMessages() {
        console.log('\n================================================');
        console.log('ACTUAL MESSAGES FOR YOUR ADVISORS');
        console.log('================================================\n');
        
        const actualMessages = {
            'Shruti Petkar': {
                template: 'family_monthly_wealth_report',
                params: [
                    'Shruti',                    // Name
                    'March 2024',               // Month
                    '45,00,000',               // Portfolio value
                    '2.3',                     // Monthly growth
                    '18.5',                    // YTD returns
                    '73',                      // Home fund progress
                    '12,00,000',              // Education fund
                    '48,000',                  // SIP growth
                    '15,000',                  // Tax saved
                    '1'                        // Insurance coverage
                ],
                actualMessage: `Dear Shruti,

üìä *Your Family Wealth Report - March 2024*

*Portfolio Performance:*
‚Ä¢ Total Value: ‚Çπ45,00,000
‚Ä¢ Monthly Growth: 2.3%
‚Ä¢ YTD Returns: 18.5%

*Goal Progress:*
üè† Home Purchase Fund: 73% complete
üéì Children Education: ‚Çπ12,00,000 accumulated
üíä Health Emergency Fund: ‚úÖ Fully funded
üë¥ Retirement Corpus: On track

*This Month's Achievements:*
‚ú® SIP investments grew by ‚Çπ48,000
‚ú® Tax saved through ELSS: ‚Çπ15,000

*Action Items:*
1. Review term insurance (currently ‚Çπ1 crore)
2. Increase SIP by 10% (recommended)
3. Start PPF for tax benefits

Schedule your monthly review: Call 9999999999`
            },
            
            'Shri Avalok Petkar': {
                template: 'entrepreneur_business_wealth',
                params: [
                    'Avalok',                   // Name
                    '5',                       // Business assets in Cr
                    '75',                      // Personal investments in lakhs
                    '87',                      // Business ratio
                    '13',                      // Personal ratio
                    '35',                      // Equity MF value
                    '22',                      // Equity returns
                    '15',                      // REITs value
                    '8.5',                     // REIT yield
                    '15',                      // Liquid funds
                    '10',                      // International
                    '46,800',                  // Tax saved via ELSS
                    '25,000',                  // HUF benefits
                    '1,20,000'                 // Corporate savings
                ],
                actualMessage: `Avalok, optimize your business wealth! üíº

*Business vs Personal Portfolio:*

*Business Assets:* ‚Çπ5 Cr
*Personal Investments:* ‚Çπ75 lakhs
*Ratio:* 87:13 (Target 70:30)

*Diversification Strategy:*
üìä Equity MFs: ‚Çπ35L (22% returns)
üè¢ REITs: ‚Çπ15L (8.5% yield)
üí∞ Liquid Funds: ‚Çπ15L (emergency)
üåç International: ‚Çπ10L

*Tax Optimization:*
‚Ä¢ Saved via ELSS: ‚Çπ46,800
‚Ä¢ HUF benefits: ‚Çπ25,000
‚Ä¢ Corporate structure: ‚Çπ1,20,000 saved

*Q4 Opportunity:* Pre-IPO placement in fintech
Expected returns: 35-40% in 18 months
Allocation suggested: ‚Çπ25 lakhs

Interested?`
            },
            
            'Vidyadhar Petkar': {
                template: 'retirement_income_statement',
                params: [
                    'Vidyadhar',               // Name
                    '35,000',                  // Pension
                    '8,000',                   // Senior Citizen Scheme
                    '5,500',                   // Post Office MIS
                    '15,000',                  // Debt Fund SWP
                    '12,000',                  // Rental Income
                    '75,500',                  // Total monthly
                    '55,000',                  // Expenses
                    '20,500',                  // Surplus
                    '85,00,000',              // Total savings
                    '3,30,000',               // Emergency fund
                    '10,00,000'               // Health reserve
                ],
                actualMessage: `Good morning Vidyadhar üåÖ

*Your Monthly Income Summary:*

*Regular Income:*
‚Ä¢ Pension: ‚Çπ35,000
‚Ä¢ Senior Citizen Scheme: ‚Çπ8,000
‚Ä¢ Post Office MIS: ‚Çπ5,500
‚Ä¢ Debt Fund SWP: ‚Çπ15,000
‚Ä¢ Rental Income: ‚Çπ12,000

*Total Monthly: ‚Çπ75,500* ‚úÖ
*Expenses: ‚Çπ55,000*
*Surplus: ‚Çπ20,500*

*Corpus Status:*
‚Ä¢ Total Savings: ‚Çπ85,00,000
‚Ä¢ Emergency Fund: ‚Çπ3,30,000 (6 months)
‚Ä¢ Health Reserve: ‚Çπ10,00,000

Your money is safe and growing steadily.

üòä Enjoy your retirement worry-free!`
            }
        };
        
        // Display actual messages
        for (const [advisor, content] of Object.entries(actualMessages)) {
            console.log(`\nüì± ${advisor}:`);
            console.log('‚îÄ'.repeat(50));
            console.log(content.actualMessage);
            console.log('‚îÄ'.repeat(50));
        }
        
        // Save to file for reference
        await fs.writeFile(
            path.join(process.cwd(), 'advisor-messages.json'),
            JSON.stringify(actualMessages, null, 2)
        );
        
        console.log('\n‚úÖ Actual messages saved to: advisor-messages.json');
        
        return actualMessages;
    }
}

// Main execution
async function main() {
    const templateManager = new FinAdviseCompleteTemplates();
    
    // Register all templates
    await templateManager.registerAllCompleteTemplates();
    
    // Generate and display actual messages
    await templateManager.generateActualMessages();
    
    console.log('\n================================================');
    console.log('IMPORTANT: PROFESSIONAL CONTENT ONLY');
    console.log('================================================');
    console.log('‚úÖ NO test messages will be sent');
    console.log('‚úÖ Only professional financial content');
    console.log('‚úÖ Personalized for each advisor segment');
    console.log('‚úÖ Rich media support (images, documents, buttons)');
}

if (require.main === module) {
    main().catch(console.error);
}

module.exports = FinAdviseCompleteTemplates;