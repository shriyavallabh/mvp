# Story 4.1: Video Content Generation MVP

## Status
Draft

## Story
**As a** mutual fund advisor,
**I want** to generate short-form video content alongside my existing image posts,
**so that** I can increase engagement rates and appeal to video-preferring audiences on social media platforms

## Acceptance Criteria
1. System can generate 30-60 second video content for advisor's daily posts
2. Video generation integrates with existing content pipeline without disrupting current workflow
3. Videos include advisor branding elements (name, ARN number, contact)
4. Generated videos comply with SEBI guidelines for financial content
5. Video content can be distributed via WhatsApp alongside existing image posts
6. Performance metrics track video engagement vs image-only posts
7. Video generation completes within the existing 30-minute processing window for 50+ advisors
8. Fallback mechanism exists to use image-only content if video generation fails

## Tasks / Subtasks
- [ ] Task 1: Research and integrate video generation API (AC: 1, 2)
  - [ ] Evaluate video generation APIs (Synthesia, D-ID, or custom solution)
  - [ ] Set up API authentication and configuration
  - [ ] Create video generation service module in `/services/video/`
  - [ ] Implement rate limiting and quota management
- [ ] Task 2: Create video content agent (AC: 1, 3, 4)
  - [ ] Build `/video-creator` agent under content-orchestrator hierarchy
  - [ ] Implement text-to-video conversion logic
  - [ ] Add advisor branding overlay system
  - [ ] Integrate compliance validation for video content
- [ ] Task 3: Extend content pipeline (AC: 2, 5)
  - [ ] Modify `/content-orchestrator` to trigger video generation
  - [ ] Update Google Drive structure to store video files
  - [ ] Extend WhatsApp distribution to support video messages
  - [ ] Update content status tracking in Google Sheets
- [ ] Task 4: Implement performance optimizations (AC: 7, 8)
  - [ ] Add parallel video processing capability
  - [ ] Implement caching for common video elements
  - [ ] Create fallback handler for video generation failures
  - [ ] Add circuit breaker pattern for API failures
- [ ] Task 5: Add analytics tracking (AC: 6)
  - [ ] Extend analytics-tracker agent for video metrics
  - [ ] Add video engagement columns to Google Sheets
  - [ ] Create comparison reports for video vs image performance
- [ ] Task 6: Testing and validation (AC: all)
  - [ ] Unit tests for video generation service
  - [ ] Integration tests for pipeline changes
  - [ ] Performance testing with 50+ advisor load
  - [ ] SEBI compliance validation for video content

## Dev Notes

### Previous Story Insights
From Story 3.1 (Production Optimization):
- WhatsApp integration successfully handles media delivery via approved templates
- V2 Deliverability Engine architecture supports multiple content types
- Current system processes 50+ advisors in under 30 minutes successfully
- Template strategy using UTILITY category ensures 100% delivery rate

### Architecture Context

#### Agent Hierarchy Integration
[Source: architecture/2-agent-architecture.md#2.1]
The new `/video-creator` agent will be added as a Level 2 agent under `content-orchestrator`, parallel to existing agents:
```yaml
content-orchestrator (Level 1)
  - content-strategist (Level 2)
  - content-generator (Level 2)  
  - image-creator (Level 2)
  - video-creator (Level 2) # NEW
  - compliance-validator (Level 2)
```

#### Agent Communication Protocol
[Source: architecture/2-agent-architecture.md#2.2.1]
Video creator agent will use standard message format:
```javascript
{
  "agent_id": "video-creator",
  "action": "GENERATE_VIDEO",
  "payload": {
    "content_text": "...",
    "advisor_arn": "ARN_12345",
    "branding": {...}
  }
}
```

#### Integration Points
[Source: architecture/4-integration-architecture.md#4.1, #4.2]
- Google Sheets: Add video_url and video_metrics columns to content tracking
- WhatsApp API: Extend to support video message type (max 16MB)
- Google Drive: Create `/videos/` folder structure parallel to `/images/`

#### Infrastructure Considerations
[Source: architecture/5-infrastructure-architecture.md#5.1]
Current VM specs (1 vCPU, 1GB RAM) may need evaluation for video processing load. Consider:
- Offloading video generation to external API
- Implementing queue-based processing
- Using PM2 cluster mode for parallel processing

#### File Structure
Based on existing project structure:
- `/services/video/` - Video generation service
- `/agents/generators/video-creator.js` - Video creator agent
- `/config/video.config.js` - Video API configuration
- `/jobs/video-processor.js` - Batch video processing job

### Testing Standards
[Source: Inferred from existing test patterns]
- Test files location: `/tests/services/video/`, `/tests/agents/generators/`
- Use Jest framework for unit tests
- Mock external API calls in tests
- Performance benchmarks required for 50+ advisor load
- Include SEBI compliance validation in test suite

### Technical Constraints
- Video file size limit: 16MB for WhatsApp distribution
- Processing time budget: Must fit within 30-minute window
- API rate limits: Depends on chosen video generation service
- Storage: Consider video file retention policy (7 days similar to images)

### Compliance Requirements
- All video content must include SEBI disclaimer
- ARN number must be visible in video
- No guaranteed returns or misleading claims
- Risk statements required for investment content

## Change Log
| Date | Version | Description | Author |
|------|---------|-------------|---------|
| 2025-01-11 | 1.0 | Initial story creation for Phase 4 - Video Content | Bob (Scrum Master) |

## Dev Agent Record
_To be populated during implementation_

### Agent Model Used
_To be populated_

### Debug Log References
_To be populated_

### Completion Notes List
_To be populated_

### File List
_To be populated_

## QA Results
_To be populated after implementation_